<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="">
    <title>智能搜索-演示Demo</title>
    <!-- Bootstrap core CSS -->
    <link rel="stylesheet" href="/static/page/css/bootstrap.min.css">
    <link rel="stylesheet" href="/static/page/css/bootstrap-theme.min.css">
    <link rel="stylesheet" href="/static/page/css/jquery.autocomplete.css">

<!-- <script  type="text/javascript" src="/static/page/js/jquery.min.js"></script> -->
<!-- <script  type="text/javascript" src="/static/page/js/jquery.autocomplete.min.js"></script>  -->
<!-- <script  type="text/javascript" src="/static/page/js/indexUtil.js"></script> -->

    <style type="text/css">
      .order_box .stitle { 
      width: 825px;
      clear: right;
      height: 27px;
      border-bottom: 2px solid #A10000;
      }
      .order_box .stitle .close {
      width: 80px;
      height: 18px;
      border-top: 1px solid #dedede;
      border-left: 1px solid #dedede;
      border-right: 1px solid #dedede;
      background: #f1f1f1;
      color: #000;
      text-align: center;
      float: left;
      margin-right: 5px;
      padding-top: 8px;
      }
      .order_box .stitle .open {
      width: 82px;
      height: 20px;
      background: #A10000;
      color: #fff;
      text-align: center;
      float: left;
      margin-right: 5px;
      padding-top: 8px;
      overflow: hidden;
      }
      .order_box ul li {
      cursor: pointer;
      display: list-item;
      list-style:none;
      }
    </style>

    <style type='text/css'>
      body {padding-top: 300px;}
      .starter-template {
      padding: 10px 5px;
      text-align: center;
      }
    </style>

    <script type="text/javascript" src="/static/jquery/jquery-1.8.2.min.js">
    </script>
    <script type="text/javascript" src="/static/jquery/jquery-ui-1.9.1.custom.min.js">
    </script>
    <script type="text/javascript" src="/static/dt-1.9.4/js/jquery.dataTables.min.js">
    </script>
    <script type="text/javascript" src="/static/yarn.dt.plugins.js">
    </script>
    <script type="text/javascript" src="/static/page/js/jquery.min.js">
    </script>
    <script type="text/javascript" src="/static/page/js/jquery.autocomplete.min.js">
    </script>
    <script type="text/javascript" src="/static/page/js/indexUtil.js">
    </script>
    
    <script>
      //输入关键字自动填充
      function OnInput (event) { 
      $.ajax({ 
      type:"GET", 
      url:'./suggest?method=base&nature=true',
      data:'input='+event.target.value,
      async: true,
      cache: false,
      success : function(data) {
      // parse result json string
      var jsonobj=eval('('+data+')');
      var dataArray = new Array();
      dataArray = jsonobj.suggestions;
      $('#input').AutoComplete({
      'data': dataArray,
      'itemHeight': 10,
      "listDirection":"up",
      'width': "auto",
      'term':jsonobj.term
      }).AutoComplete('show');
      }
      });
      
      }
      //搜索按钮ajax请求返回结果
      function skipUrl (v) { 
      $.ajax({ 
      type:"GET", 
      url:'./query?method=mypage&nature=true',
      data:'input='+v+'&from=0&size='+size+'&tagType=tag1',
      success : function(data) {
      var tabStr ='';
      
      htmlStr =initPage(v,data);//查询后初始化界面
      
      tabStr += getCss();//获取css标签
      
      tabStr +=importJs();//引入js标签
      
      tabStr +="<script>";//添加script标签
	
	tabStr += jqueryColumn(v);//jquery实现切换栏目
	
	tabStr += columnUrl(v);//切换栏目,内容填充
	
	tabStr += pagination(v);//分页:上一页,下一页,页码
	
	tabStr += "<"+"/script>";//结束script标签
	  
	  tabStr += getColumn(htmlStr);//获取栏目标签
	  
	  clearCache(tabStr); //frame里面填充内容
	  }
	  });
	  }

	  $(document).ready(
	  function() {   
	  $('#segButton').click(function() {//点击搜索按钮执行的操作
	  skipUrl(document.getElementById('input').value);//执行查询的方法
	  });
	  });

      </script>
  </head>
  
  <body>
    <div class="navbar navbar-inverse navbar-fixed-top" >
      <div class="container">
	<div class="navbar-header">
	  <button type="button" class="navbar-toggle" data-toggle="collapse"
		  data-target=".navbar-collapse">
	    <!-- <span class="sr-only">Toggle navigation</span>  -->
	    <!-- <span class="icon-bar"></span> -->
	    <!-- <span class="icon-bar"></span> -->
	    <!-- <span class="icon-bar"></span> -->
	  </button>
	  <a class="navbar-brand" href="">智能搜索-Demo</a>
	</div>
      </div>
    </div>

    

    <div class="container">
      <form name="form1" id="form1" method="get" action="./index">
	<div class="starter-template">
	  <!-- <input type="text" style="width: 65%; height:35px;" name="input" id="input" oninput="OnInput(event)" autoComplete="off"></input> -->
	  <input id="kw1" type="text" autocomplete="off" style="width: 65%; height:35px;" maxlength="100" name="input">
	  <input type="hidden" value="mypage" name="method">
	  <input type="hidden" value="true" name="nature">
	  <input type="hidden" value="0" name="from">
	  <input type="hidden" value="10" name="size">
	  <input type="submit" class="btn btn-primary" id="segButton" value="搜索" />
	</div>
      </form>
      <!-- <div class="starter-template"> -->
      <!-- 	<iframe name="NLP" id="NLP" style="height:600px; width:100%;"  frameborder="0"></iframe> -->
      <!-- </div> -->
    </div>
  </body>
</html>


/**
* 参数注释
* v:输入框关键字
* f:记录是哪个栏目(比如tag1代表锡城资讯,tag2信息公开tag3行政服务,tag4政民互动,tag5代表锡城资讯,其他)
* data:ajax请求后返回来的json数据
* flag:记录跳转页
* n:选择的页数(比如选择页码2或是页码3....这个页码2或是页码3就是n)
* c:记录当前页(比如从当前页第2页跳转到第3页,这个第2页就是c)
* t:控制每页显示多少条标记位
*/
var size=8;//每页显示多少数据
/**
* 获取CSS标签
* @return
*/
function getCss() {
return styleStr;
}

/**
* 获取<li>标签
  * @param url
  * @param value
  * @param time
  * @return
  */
  function getLiTarGet(url,value,time,content) {
  var liStr = "<li><a href="+url+">"+value+"</a>&nbsp;"+time+"<br>"+content+"</li><br>";
return liStr;
}

/**
* 获取栏目div
* @param htmlStr
* @return
*/
function getColumn(htmlStr){ 
var columnStr = "<div class='order_box'>"+
  "<div class='stitle'>"+
    "<ul>"+
      "<li class='open'>魅力锡城</li>"+
      "<li class='close'>锡城资讯</li>"+
      "<li class='close'>信息公开 </li>"+
      "<li class='close'>公共服务</li>"+
      "<li class='close'>行政服务</li>"+
      "<li class='close'>政民互动</li>"+
      "</ul>"+
    "</div>"+
  "<div class='cntorder' id='tabInfoDiv'>"+htmlStr+"</div>"+
  "<div class='cntorder' id='publicDiv' style='display: none;'></div>"+
  "<div class='cntorder' id='serverDiv' style='display: none;'></div>"+
  "<div class='cntorder' id='interactionDiv' style='display: none;'></div>"+
  "<div class='cntorder' id='ontherDiv' style='display: none;'></div>"+
  "</div> ";
return columnStr;
}

/**
* 查询后初始化界面
* @param v
* @param data
* @return
*/
function initPage(v,data){ 
var intiUrl = '';
var jsonobj=eval('('+data+')');
var strAry = new Array();
var htmlStr='';
var pageStr='';//然后其他的地方columnUrl,pagination
clearCache(null);//初始化frame
var time;
for(var i=0;i<jsonobj.pageList.length;i++){
    		if(jsonobj.pageList[i].time=="null"){
    		time ="";
    		}else{
    		time = jsonobj.pageList[i].time;
    		}
		intiUrl +=  getLiTarGet(jsonobj.pageList[i].url,jsonobj.pageList[i].contenttitle,time,jsonobj.pageList[i].content);
		}
		intiUrl += "<div style=width:600px;text-align:center;>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;";
		for (var i = 1; i <= Math.ceil(jsonobj.count/size); i++) {
				     if (i <= size){
					      if(i==1||i==jsonobj.from/size){
					      var  pg = "<Font color=black>" + i + "</font>";
					      }else{
					      var  pg = "<Font color=red>" + i + "</font>";
					      }
					      
					      intiUrl += "<a style='cursor:pointer' onclick='javascript:pageT(\"" + v+ "\","+i+","+jsonobj.from+",0);'>["+pg+"]</a>&nbsp;";
					      }
					      }
					      if(jsonobj.from/size>size){
				     intiUrl += "<span id='page_next' style='cursor:pointer' onclick='pages_next(\"" + v+ "\",0,0)'>下一页>></span>"+
				     "</div>";
				     }
				     return intiUrl;
				     }   

				     /**
				     * 引入js标签
				     * @return
				     */
				     function importJs() {
				     var jsStr = "<script  type=\"text/javascript\" src=\"/static/page/js/jquery.min.js\"></script>"+
				     "<script  type=\"text/javascript\" src=\"/static/page/js/jquery.autocomplete.min.js\"></script> "+
				     "<script  type=\"text/javascript\" src=\"/static/page/js/indexUtil.js\"></script>";
				     return jsStr;
				     }  
				     /**
				     * jquery实现切换栏目
				     * @param v
				     * @return
				     */
				     function jqueryColumn(v){
				     var jquertStr =  "$(function () {"+
				     "$('.stitle li').click(function () {"+
				     " var tabFlag='';var index_tab = $(this).parent().children().index($(this));"+
				     "tabFlag = index_tab;"+
				     "$(this).parent().find('.open').removeClass('open').addClass('close'); "+
				     "$(this).removeClass('close').addClass('open');"+
				     "var content_obj = $('.cntorder');"+
				     "content_obj.hide();"+
				     "content_obj.eq(index_tab).show();"+
				     "columnPage(\"" + v+ "\",tabFlag,document.getElementById('tabInfoDiv'));"+
				     "});"+ 
				     "});";
				     return 	jquertStr;		          
				     }
				     /**
				     * 切换栏目,内容填充
				     * @param v
				     * @return
				     */
				     function columnUrl(v){
				     var columnStr = "function columnPage(v,flag,div){"+
				     "$.ajax({"+
				     "type:'POST',"+ 
				     "url:'./query?method=mypage&nature=true',"+
				     "data:'input='+v+'&&from=0&&size="+size+"&&tagType=tag'+parseInt(flag+1)+'',"+
				     "success : function(data) {"+
				     "var obj='';var time;"+
				     "var jsonobj=eval('('+data+')');"+
				     "for(var i=0;i<jsonobj.pageList.length;i++){"+
				     "if(jsonobj.pageList[i].time=='null'){"+
				     "	  time ='';"+
				     "	}else{"+
				     "  time = jsonobj.pageList[i].time;"+
				     "}"+
				     "obj+='<li><a href='+jsonobj.pageList[i].url+'>'+jsonobj.pageList[i].contenttitle+'</a>&nbsp;'+time+'<br>'+jsonobj.pageList[i].content+'</li><br>';"+
				     "}"+
				     "obj+='<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp</span>';"+
				     "for (var i = 1; i <= Math.ceil(jsonobj.count/"+size+"); i++){"+
				     " if (i <= "+size+"){"+
				     "if(i==1||i==parseInt(jsonobj.from/"+size+")){"+
				     "var  pg = '<Font color=black>' + i + '</font>';"+
				     "}else{"+
				     "var pg = '<Font color=red>' + i + '</font>';"+
				     "}"+
				     "obj+='<a style=cursor:pointer onclick=javascript:pageT(\"" + v+ "\",'+i+','+jsonobj.from+','+flag+');>['+pg+']</a>&nbsp;'"+
				     "}"+
				     "}"+
				     "if(jsonobj.from/"+size+">"+size+"){"+
				     "obj+='<span style=cursor:pointer onclick=pages_next(\"" + v+ "\",'+currentPage+','+flag+')>下一页>></span>';"+
				     "}"+
				     "document.getElementById('tabInfoDiv').style.display='none';"+
				     "document.getElementById('tabInfoDiv').innerHTML='';"+
				     "div.style.display='block';"+
				     "div.innerHTML=obj;"+
				     "}"+
				     "});"+
				     "}";
				     return columnStr;
				     }

				     /**
				     * 分页:上一页,下一页,页码
				     * @param v
				     * @return
				     */
				     function pagination(v){
				     var pagStr = "function pageT(v,n,c,f){"+
				     "$.ajax({"+
				     "type:'POST',"+ 
				     "url:'./query?method=mypage&nature=true',"+
				     "data:'input='+v+'&&from='+parseInt(n-1)*"+size+"+'&&size="+size+"&&tagType=tag'+parseInt(f+1)+'',"+
				     "success : function(data) {"+
				     " var obj='';var time;var t=1;var flag= '';document.getElementById('tabInfoDiv').innerHTML='';"+
				     "var jsonobj=eval('('+data+')');"+
				     "var currentPage =jsonobj.from;"+
				     "for(var i=0;i<jsonobj.pageList.length;i++){"+
				     "if(jsonobj.pageList[i].time=='null'){"+
				     "	  time ='';"+
				     "	}else{"+
				     "  time = jsonobj.pageList[i].time;"+
				     "}"+
				     "obj+='<li><a href='+jsonobj.pageList[i].url+'>'+jsonobj.pageList[i].contenttitle+'</a>&nbsp;'+time+'<br>'+jsonobj.pageList[i].content+'</li><br>';"+
				     "}"+
				     "obj+='<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp</span>';"+
				     "if(jsonobj.from!=0){"+
				     "obj+='<span style=cursor:pointer; onclick=pages_prev(\"" + v+ "\",'+currentPage+','+f+')><<上一页&nbsp;</span>';"+
				     "}"+
				     "if(c<n){"+
				     "if(c==0){"+
				     "flag=parseInt(n-c-1)"+
				     "}else if(c==1){"+
				     "flag=parseInt(n-c+2)"+
				     "}else if(c==2){"+
				     "flag=parseInt(n-c+1)"+
				     "}else{"+
				     "flag=parseInt(n-1)}"+
				     "}else{"+
				     "if(n==2){"+
				     "flag=1"+
				     "}else if(n==1){"+
				     "flag=0"+
				     "}else{"+
				     "flag=n"+
				     "}"+
				     "}"+
				     "if(n>=12){"+
				     "t=parseInt(n-10)"+
				     "}else{"+
				     "t=1"+
				     "}"+
				     "for (var i=t; i <= Math.ceil(jsonobj.count/"+size+"); i++){"+
				     "if (i <= parseInt(flag+10)){"+
				     " if(i==1||i==parseInt(jsonobj.from+"+size+")/"+size+"){"+
				     " var  pg = '<Font color=black>' + i + '</font>';"+
				     "}else{"+
				     "  var  pg = '<Font color=red>' + i + '</font>';"+
				     "}"+
				     
				     "obj+='<a style=cursor:pointer onclick=javascript:pageT(\"" + v+ "\",'+i+','+(jsonobj.from+"+size+")/"+size+"+','+f+');>['+pg+']</a>&nbsp;'"+
				     "}"+
				     "}"+
				     "if(n!=Math.ceil(jsonobj.count/"+size+")){"+
				     "obj+='<span style=cursor:pointer onclick=pages_next(\"" + v+ "\",'+currentPage+','+f+')>下一页>></span>';"+
				     "}"+
				     "document.getElementById('tabInfoDiv').innerHTML=obj"+
				     "}"+
				     "});"+
				     "}"+
				     "function pages_next(v,n,f){"+
				     "$.ajax({"+
				     "type:'POST',"+ 
				     "url:'./query?method=mypage&nature=true',"+
				     "data:'input='+v+'&&from='+parseInt(n+"+size+")+'&&size="+size+"&&tagType=tag'+parseInt(f+1)+'',"+
				     "success : function(data) {"+
				     " var obj='';var time;var t=1;var flag= '';document.getElementById('tabInfoDiv').innerHTML='';"+
				     "var jsonobj=eval('('+data+')');"+
				     "var currentPage =jsonobj.from;"+
				     "for(var i=0;i<jsonobj.pageList.length;i++){"+
				     "if(jsonobj.pageList[i].time=='null'){"+
				     "	  time ='';"+
				     "	}else{"+
				     "  time = jsonobj.pageList[i].time;"+
				     "}"+
				     "obj+='<li><a href='+jsonobj.pageList[i].url+'>'+jsonobj.pageList[i].contenttitle+'</a>&nbsp;'+time+'<br>'+jsonobj.pageList[i].content+'</li><br>';"+
				     "}"+
				     "obj+='<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp</span>';"+
				     "obj+='<span style=cursor:pointer; onclick=pages_prev(\"" + v+ "\",'+currentPage+','+f+')><<上一页&nbsp;</span>';"+
				     "flag=parseInt((n/"+size+")+1);"+
				     "if(flag>=11){"+
				     "t=flag-9"+
				     "}else{"+
				     "t=1"+
				     "}"+
				     "for (var i = t; i <= Math.ceil(jsonobj.count/"+size+"); i++){"+
				     "if (i <= parseInt(flag+10)){"+
				     " if(i==t||i==parseInt(jsonobj.from+"+size+")/"+size+"){"+
				     " var  pg = '<Font color=black>' + i + '</font>';"+
				     "}else{"+
				     "  var  pg = '<Font color=red>' + i + '</font>';"+
				     "}"+
				     
				     "obj+='<a style=cursor:pointer onclick=javascript:pageT(\"" + v+ "\",'+i+','+f+');>['+pg+']</a>&nbsp;'"+
	"}"+
	"}"+
	"obj+='<span style=cursor:pointer onclick=pages_next(\"" + v+ "\",'+currentPage+','+f+')>下一页>></span>';"+
	"document.getElementById('tabInfoDiv').innerHTML=obj"+
        "}"+
	"});"+
	"}"+
	"function pages_prev(v,n,f){"+
	"$.ajax({"+
	"type:'POST',"+ 
        "url:'./query?method=mypage&nature=true',"+
        "data:'input='+v+'&&from='+parseInt(n-"+size+")+'&&size="+size+"&&tagType=tag'+parseInt(f+1)+'',"+
        "success : function(data) {"+
        " var obj='';var time;var t=1;var flag= '';document.getElementById('tabInfoDiv').innerHTML='';"+
        "var jsonobj=eval('('+data+')');"+
        "var currentPage =jsonobj.from;"+
        "for(var i=0;i<jsonobj.pageList.length;i++){"+
        "if(jsonobj.pageList[i].time=='null'){"+
        "	  time ='';"+
        "	}else{"+
        "  time = jsonobj.pageList[i].time;"+
        "}"+
	"obj+='<li><a href='+jsonobj.pageList[i].url+'>'+jsonobj.pageList[i].contenttitle+'</a>&nbsp;'+time+'<br>'+jsonobj.pageList[i].content+'</li><br>';"+
	"}"+
	"obj+='<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp</span>';"+
	"if(jsonobj.from!=0){"+
	"obj+='<span style=cursor:pointer; onclick=pages_prev(\"" + v+ "\",'+currentPage+','+f+')><<上一页&nbsp;</span>';"+
	"}"+
	"flag=parseInt((n/"+size+"));"+
	"if(flag<11){"+
	"t=1"+
	"}else{"+
	"t=parseInt(flag-10)"+
	"}"+
	"for (var i = t; i <= Math.ceil(jsonobj.count/"+size+"); i++){"+
	"if (i <= parseInt(flag+9)){"+
	" if(i==1||i==parseInt(jsonobj.from+"+size+")/"+size+"){"+
        " var  pg = '<Font color=black>' + i + '</font>';"+
        "}else{"+
        "  var  pg = '<Font color=red>' + i + '</font>';"+
        "}"+
        
    "obj+='<a style=cursor:pointer onclick=javascript:pageT(\"" + v+ "\",'+i+','+f+');>['+pg+']</a>&nbsp;'"+
	"}"+
	"}"+
	"obj+='<span style=cursor:pointer onclick=pages_next(\"" + v+ "\",'+currentPage+','+f+')>下一页>></span>';"+
	"document.getElementById('tabInfoDiv').innerHTML=obj"+
        "}"+
	"});"+
	"}";
    return pagStr;
}

/**
 * 初始化frame
 * @param tabStr
 * @return
 */
function clearCache(tabStr) {
    
    window.frames["NLP"].document.open(); 
    if(tabStr!=null||tabStr!="")
	window.frames["NLP"].document.write(tabStr);
    else
	window.frames["NLP"].document.write("");
    
    window.frames["NLP"].document.close();
}
